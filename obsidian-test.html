<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obsidian API æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        button {
            padding: 12px 20px;
            margin: 5px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: linear-gradient(135deg, #007AFF, #5856D6);
            color: white;
        }
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,122,255,0.3);
        }
        .result-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        .result-content {
            white-space: pre-wrap;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.5;
            max-height: 400px;
            overflow-y: auto;
        }
        .success {
            background: #d4edda;
            border-color: #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border-color: #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Obsidian API æµ‹è¯•å·¥å…·</h1>
        
        <div class="config-section">
            <h3>ğŸ“‹ API é…ç½®</h3>
            <div class="form-group">
                <label for="apiPort">API ç«¯å£:</label>
                <input type="number" id="apiPort" value="27123" placeholder="27123">
            </div>
            <div class="form-group">
                <label for="vaultName">ä»“åº“åç§°:</label>
                <input type="text" id="vaultName" value="ob-flomo" placeholder="ob-flomo">
            </div>
        </div>

        <div>
            <button onclick="testConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
            <button onclick="createTestNote()">ğŸ“ åˆ›å»ºæµ‹è¯•ç¬”è®°</button>
            <button onclick="testAllEndpoints()">ğŸ› ï¸ å…¨é¢æµ‹è¯•</button>
        </div>

        <div id="result" class="result-section" style="display: none;">
            <h4>ğŸ“Š æµ‹è¯•ç»“æœ:</h4>
            <div id="resultContent" class="result-content"></div>
        </div>
    </div>

    <script>
        function getConfig() {
            return {
                port: document.getElementById('apiPort').value || 27123,
                vault: document.getElementById('vaultName').value || 'ob-flomo'
            };
        }

        function showResult(content, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const contentDiv = document.getElementById('resultContent');
            
            resultDiv.className = `result-section ${isSuccess ? 'success' : 'error'}`;
            contentDiv.textContent = content;
            resultDiv.style.display = 'block';
            
            // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        async function testConnection() {
            const config = getConfig();
            const baseUrl = `http://localhost:${config.port}`;
            
            try {
                console.log('æµ‹è¯• API è¿æ¥:', baseUrl);
                
                // æµ‹è¯•åŸºç¡€ API
                const response = await fetch(`${baseUrl}/`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                let result = `ğŸ” è¿æ¥æµ‹è¯•ç»“æœ:\n\n`;
                result += `API åœ°å€: ${baseUrl}\n`;
                result += `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                
                if (response.status === 200 || response.status === 404) {
                    result += `âœ… API æœåŠ¡æ­£åœ¨è¿è¡Œ!\n\n`;
                    
                    // æµ‹è¯•ä»“åº“è®¿é—®
                    const vaultUrl = `${baseUrl}/vault/${encodeURIComponent(config.vault)}`;
                    console.log('æµ‹è¯•ä»“åº“è¿æ¥:', vaultUrl);
                    
                    const vaultResponse = await fetch(vaultUrl, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    result += `ä»“åº“æµ‹è¯•åœ°å€: ${vaultUrl}\n`;
                    result += `ä»“åº“å“åº”çŠ¶æ€: ${vaultResponse.status} ${vaultResponse.statusText}\n`;
                    
                    if (vaultResponse.status === 200) {
                        result += `âœ… ä»“åº“ "${config.vault}" å­˜åœ¨ä¸”å¯è®¿é—®!\n`;
                        result += `\nğŸ‰ API é…ç½®å®Œå…¨æ­£ç¡®ï¼Œå¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æµ‹è¯•ã€‚`;
                        showResult(result, true);
                    } else if (vaultResponse.status === 404) {
                        result += `âŒ ä»“åº“ "${config.vault}" ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®\n\n`;
                        result += `ğŸ’¡ å»ºè®®æ£€æŸ¥:\n`;
                        result += `1. ç¡®è®¤ Obsidian ä¸­çš„ä»“åº“åç§°æ˜¯å¦ä¸º "${config.vault}"\n`;
                        result += `2. æ£€æŸ¥ä»“åº“åç§°æ˜¯å¦æ‹¼å†™æ­£ç¡®\n`;
                        result += `3. ç¡®è®¤ Obsidian å·²æ‰“å¼€è¯¥ä»“åº“\n`;
                        result += `4. ä»“åº“åç§°åº”è¯¥æ˜¯ä½ åœ¨ Obsidian å·¦ä¸Šè§’çœ‹åˆ°çš„æ–‡ä»¶å¤¹åç§°`;
                        showResult(result, false);
                    } else {
                        result += `âš ï¸ ä»“åº“è®¿é—®å¼‚å¸¸ (${vaultResponse.status})`;
                        showResult(result, false);
                    }
                } else {
                    result += `âŒ API æœåŠ¡ä¸å¯ç”¨\n\n`;
                    result += `ğŸ’¡ è¯·æ£€æŸ¥:\n`;
                    result += `1. Obsidian æ˜¯å¦æ­£åœ¨è¿è¡Œ\n`;
                    result += `2. Local REST API æ’ä»¶æ˜¯å¦å·²å®‰è£…å¹¶å¯ç”¨\n`;
                    result += `3. ç«¯å£è®¾ç½®æ˜¯å¦æ­£ç¡® (${config.port})`;
                    showResult(result, false);
                }
                
            } catch (error) {
                console.error('è¿æ¥æµ‹è¯•å¤±è´¥:', error);
                const result = `âŒ è¿æ¥å¤±è´¥: ${error.message}\n\nğŸ’¡ å¸¸è§åŸå› :\n1. Obsidian æœªå¯åŠ¨\n2. Local REST API æ’ä»¶æœªå¯ç”¨\n3. ç«¯å£å·é”™è¯¯ (${config.port})\n4. ç½‘ç»œè¿æ¥é—®é¢˜`;
                showResult(result, false);
            }
        }

        async function createTestNote() {
            const config = getConfig();
            
            try {
                const now = new Date();
                const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const fileName = `æµ‹è¯•ç¬”è®°-${timestamp}.md`;
                
                const content = `# ğŸ§ª API æµ‹è¯•ç¬”è®°

**åˆ›å»ºæ—¶é—´**: ${now.toLocaleString()}
**æµ‹è¯•å·¥å…·**: Obsidian API æµ‹è¯•å·¥å…·  
**API ç«¯å£**: ${config.port}
**ä»“åº“åç§°**: ${config.vault}

---

## ğŸ“ æµ‹è¯•å†…å®¹

è¿™æ˜¯ä¸€æ¡é€šè¿‡ Local REST API åˆ›å»ºçš„æµ‹è¯•ç¬”è®°ã€‚

### âœ… æµ‹è¯•é¡¹ç›®
- [x] API è¿æ¥æµ‹è¯•
- [x] æ–‡ä»¶åˆ›å»ºæµ‹è¯•
- [x] Markdown æ ¼å¼æµ‹è¯•
- [x] ä¸­æ–‡å†…å®¹æµ‹è¯•

### ğŸ·ï¸ æ ‡ç­¾
#æµ‹è¯• #API #Obsidian #å¿«é€Ÿç¬”è®°

### ğŸ“Š æŠ€æœ¯ä¿¡æ¯
- **HTTP æ–¹æ³•**: PUT
- **Content-Type**: text/markdown
- **æ–‡ä»¶ç¼–ç **: UTF-8

---

*ç”± Obsidian API æµ‹è¯•å·¥å…·åˆ›å»ºäº ${now.toLocaleString()}*
`;

                const url = `http://localhost:${config.port}/vault/${encodeURIComponent(config.vault)}/${encodeURIComponent(fileName)}`;
                
                console.log('åˆ›å»ºæµ‹è¯•ç¬”è®°:', url);
                console.log('æ–‡ä»¶å†…å®¹é•¿åº¦:', content.length);
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'text/markdown',
                        'Accept': 'application/json'
                    },
                    body: content
                });
                
                let result = `ğŸ“ åˆ›å»ºæµ‹è¯•ç¬”è®°ç»“æœ:\n\n`;
                result += `æ–‡ä»¶å: ${fileName}\n`;
                result += `å®Œæ•´è·¯å¾„: ${config.vault}/${fileName}\n`;
                result += `API åœ°å€: ${url}\n`;
                result += `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                
                if (response.ok) {
                    result += `âœ… æµ‹è¯•ç¬”è®°åˆ›å»ºæˆåŠŸ!\n\n`;
                    result += `ğŸ“‚ è¯·æ£€æŸ¥ Obsidian ä¸­æ˜¯å¦å‡ºç°äº†æ–‡ä»¶:\n`;
                    result += `   ${fileName}\n\n`;
                    result += `ğŸ‰ æ­å–œ! API è¿æ¥å®Œå…¨æ­£å¸¸ï¼Œæ‰©å±•åŠŸèƒ½åº”è¯¥å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚\n`;
                    result += `ç°åœ¨å¯ä»¥å…³é—­æ­¤æµ‹è¯•é¡µé¢ï¼Œä½¿ç”¨æµè§ˆå™¨æ‰©å±•è¿›è¡Œæ­£å¸¸çš„ç¬”è®°è®°å½•ã€‚`;
                    showResult(result, true);
                } else {
                    let errorText = '';
                    try {
                        errorText = await response.text();
                    } catch (e) {
                        errorText = 'æ— æ³•è·å–é”™è¯¯è¯¦æƒ…';
                    }
                    
                    result += `âŒ åˆ›å»ºå¤±è´¥!\n`;
                    result += `é”™è¯¯è¯¦æƒ…: ${errorText}\n\n`;
                    
                    if (response.status === 404) {
                        result += `ğŸ’¡ 404 é”™è¯¯åˆ†æ:\n`;
                        result += `1. ä»“åº“åç§° "${config.vault}" å¯èƒ½ä¸å­˜åœ¨\n`;
                        result += `2. è¯·ç¡®è®¤ä½ åœ¨ Obsidian ä¸­çœ‹åˆ°çš„ä»“åº“åç§°\n`;
                        result += `3. æ£€æŸ¥ä»“åº“åç§°æ˜¯å¦å®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰\n`;
                        result += `4. ç¡®ä¿ Obsidian å½“å‰æ‰“å¼€çš„å°±æ˜¯è¿™ä¸ªä»“åº“`;
                    } else if (response.status === 403) {
                        result += `ğŸ’¡ 403 æƒé™é”™è¯¯:\n`;
                        result += `1. Local REST API æ’ä»¶å¯èƒ½æ²¡æœ‰å†™å…¥æƒé™\n`;
                        result += `2. æ£€æŸ¥æ’ä»¶è®¾ç½®ä¸­çš„æƒé™é…ç½®`;
                    } else {
                        result += `ğŸ’¡ å…¶ä»–é”™è¯¯ (${response.status}):\n`;
                        result += `1. è¯·æ£€æŸ¥ Obsidian å’Œæ’ä»¶çŠ¶æ€\n`;
                        result += `2. å°è¯•é‡å¯ Obsidian å’Œæ’ä»¶`;
                    }
                    
                    showResult(result, false);
                }
                
            } catch (error) {
                console.error('åˆ›å»ºç¬”è®°å¤±è´¥:', error);
                const result = `âŒ åˆ›å»ºæµ‹è¯•ç¬”è®°å¤±è´¥: ${error.message}\n\nğŸ’¡ å»ºè®®:\n1. è¯·å…ˆè¿è¡Œ"æµ‹è¯•è¿æ¥"ç¡®è®¤ API å¯ç”¨æ€§\n2. ç¡®ä¿ Obsidian æ­£åœ¨è¿è¡Œ\n3. ç¡®ä¿ Local REST API æ’ä»¶å·²å¯ç”¨`;
                showResult(result, false);
            }
        }

        async function testAllEndpoints() {
            const config = getConfig();
            const baseUrl = `http://localhost:${config.port}`;
            
            let result = `ğŸ› ï¸ å…¨é¢ API æµ‹è¯•ç»“æœ:\n\n`;
            result += `æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}\n`;
            result += `API åŸºåœ°å€: ${baseUrl}\n`;
            result += `ä»“åº“åç§°: ${config.vault}\n\n`;
            
            // æµ‹è¯•ç«¯ç‚¹åˆ—è¡¨
            const endpoints = [
                { name: 'æ ¹è·¯å¾„', url: '/', description: 'åŸºç¡€ API å¯ç”¨æ€§' },
                { name: 'ä»“åº“ä¿¡æ¯', url: '/vault', description: 'è·å–ä»“åº“åˆ—è¡¨' },
                { name: 'æŒ‡å®šä»“åº“', url: `/vault/${encodeURIComponent(config.vault)}`, description: 'è®¿é—®æŒ‡å®šä»“åº“' }
            ];
            
            for (const endpoint of endpoints) {
                try {
                    const url = `${baseUrl}${endpoint.url}`;
                    console.log(`æµ‹è¯•ç«¯ç‚¹: ${endpoint.name} - ${url}`);
                    
                    const response = await fetch(url, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    result += `ğŸ“ ${endpoint.name} (${endpoint.description}):\n`;
                    result += `   URL: ${url}\n`;
                    result += `   çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                    
                    if (response.status === 200) {
                        result += `   âœ… æ­£å¸¸è®¿é—®\n`;
                        // å°è¯•è·å–å“åº”å†…å®¹
                        try {
                            const data = await response.text();
                            if (data && data.length < 200) {
                                result += `   å“åº”: ${data.substring(0, 100)}${data.length > 100 ? '...' : ''}\n`;
                            }
                        } catch (e) {
                            // å¿½ç•¥è§£æé”™è¯¯
                        }
                    } else if (response.status === 404) {
                        result += `   âš ï¸ æœªæ‰¾åˆ° (å¯èƒ½æ­£å¸¸)\n`;
                    } else {
                        result += `   âŒ å¼‚å¸¸çŠ¶æ€\n`;
                    }
                    result += `\n`;
                    
                } catch (error) {
                    result += `ğŸ“ ${endpoint.name}: âŒ è¿æ¥å¤±è´¥ (${error.message})\n\n`;
                }
            }
            
            result += `ğŸ“‹ æµ‹è¯•æ€»ç»“:\n`;
            result += `- å¦‚æœæ ¹è·¯å¾„å’Œä»“åº“ä¿¡æ¯è¿”å› 200 æˆ– 404ï¼Œè¯´æ˜ API æœåŠ¡æ­£å¸¸\n`;
            result += `- å¦‚æœæŒ‡å®šä»“åº“è¿”å› 200ï¼Œè¯´æ˜ä»“åº“é…ç½®æ­£ç¡®\n`;
            result += `- å¦‚æœæŒ‡å®šä»“åº“è¿”å› 404ï¼Œè¯´æ˜ä»“åº“åç§°å¯èƒ½é”™è¯¯\n`;
            result += `- å¦‚æœæ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥ï¼Œè¯´æ˜ API æœåŠ¡æœªå¯åŠ¨`;
            
            showResult(result, true);
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', () => {
            console.log('ğŸ”§ Obsidian API æµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('å½“å‰é…ç½®:', getConfig());
            
            // æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
            const instructions = `ğŸ¯ ä½¿ç”¨è¯´æ˜:

1. ğŸ“‹ ç¡®è®¤é…ç½®ä¿¡æ¯æ˜¯å¦æ­£ç¡®
2. ğŸ” ç‚¹å‡»"æµ‹è¯•è¿æ¥"æ£€æŸ¥ API å¯ç”¨æ€§  
3. ğŸ“ ç‚¹å‡»"åˆ›å»ºæµ‹è¯•ç¬”è®°"æµ‹è¯•å†™å…¥åŠŸèƒ½
4. ğŸ› ï¸ ç‚¹å‡»"å…¨é¢æµ‹è¯•"è¿›è¡Œè¯¦ç»†è¯Šæ–­

ğŸ’¡ æç¤º: è¯·ç¡®ä¿ Obsidian æ­£åœ¨è¿è¡Œä¸” Local REST API æ’ä»¶å·²å¯ç”¨ã€‚`;
            
            showResult(instructions, true);
        });
    </script>
</body>
</html> 