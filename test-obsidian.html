<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Obsidian API æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        .config-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }
        input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 14px;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #007AFF;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .btn-primary {
            background: linear-gradient(135deg, #007AFF, #5856D6);
            color: white;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,122,255,0.3);
        }
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-test {
            background: #28a745;
            color: white;
        }
        .btn-test:hover {
            background: #218838;
        }
        .result-section {
            margin-top: 30px;
            padding: 20px;
            border-radius: 8px;
            display: none;
        }
        .result-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 12px;
            line-height: 1.5;
        }
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Obsidian API æµ‹è¯•å·¥å…·</h1>
        
        <div class="config-section">
            <h3>ğŸ“‹ API é…ç½®</h3>
            <div class="form-group">
                <label for="apiPort">API ç«¯å£:</label>
                <input type="number" id="apiPort" value="27123" placeholder="27123">
            </div>
            <div class="form-group">
                <label for="vaultName">ä»“åº“åç§°:</label>
                <input type="text" id="vaultName" value="ob-flomo" placeholder="ob-flomo">
            </div>
        </div>

        <div class="button-group">
            <button class="btn-test" onclick="testConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
            <button class="btn-primary" onclick="createTestNote()">ğŸ“ åˆ›å»ºæµ‹è¯•ç¬”è®°</button>
            <button class="btn-secondary" onclick="testApiEndpoints()">ğŸ› ï¸ æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹</button>
        </div>

        <div id="result" class="result-section">
            <h4>ğŸ“Š æµ‹è¯•ç»“æœ:</h4>
            <div id="resultContent" class="result-content"></div>
        </div>
    </div>

    <script>
        // è·å–å½“å‰é…ç½®
        function getConfig() {
            return {
                port: document.getElementById('apiPort').value || 27123,
                vault: document.getElementById('vaultName').value || 'ob-flomo'
            };
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(content, isSuccess = true) {
            const resultDiv = document.getElementById('result');
            const contentDiv = document.getElementById('resultContent');
            
            resultDiv.className = `result-section ${isSuccess ? 'result-success' : 'result-error'}`;
            contentDiv.textContent = content;
            resultDiv.style.display = 'block';
        }

        // è®¾ç½®åŠ è½½çŠ¶æ€
        function setLoading(loading) {
            document.querySelector('.container').classList.toggle('loading', loading);
        }

        // æµ‹è¯•åŸºç¡€è¿æ¥
        async function testConnection() {
            const config = getConfig();
            setLoading(true);
            
            try {
                const baseUrl = `http://localhost:${config.port}`;
                
                // æµ‹è¯•åŸºç¡€ API
                console.log('æµ‹è¯•åŸºç¡€ API:', baseUrl);
                const response = await fetch(`${baseUrl}/`, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' }
                });
                
                let result = `ğŸ” è¿æ¥æµ‹è¯•ç»“æœ:\n\n`;
                result += `API åœ°å€: ${baseUrl}\n`;
                result += `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                
                if (response.status === 200 || response.status === 404) {
                    result += `âœ… API æœåŠ¡æ­£åœ¨è¿è¡Œ!\n\n`;
                    
                    // æµ‹è¯•ä»“åº“è®¿é—®
                    const vaultUrl = `${baseUrl}/vault/${encodeURIComponent(config.vault)}`;
                    console.log('æµ‹è¯•ä»“åº“è®¿é—®:', vaultUrl);
                    
                    const vaultResponse = await fetch(vaultUrl, {
                        method: 'GET',
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    result += `ä»“åº“æµ‹è¯•åœ°å€: ${vaultUrl}\n`;
                    result += `ä»“åº“å“åº”çŠ¶æ€: ${vaultResponse.status} ${vaultResponse.statusText}\n`;
                    
                    if (vaultResponse.status === 200) {
                        result += `âœ… ä»“åº“ "${config.vault}" å­˜åœ¨ä¸”å¯è®¿é—®!\n`;
                        showResult(result, true);
                    } else if (vaultResponse.status === 404) {
                        result += `âŒ ä»“åº“ "${config.vault}" ä¸å­˜åœ¨æˆ–æ— æ³•è®¿é—®\n`;
                        result += `\nğŸ’¡ å»ºè®®æ£€æŸ¥:\n`;
                        result += `1. ç¡®è®¤ Obsidian ä¸­çš„ä»“åº“åç§°æ˜¯å¦ä¸º "${config.vault}"\n`;
                        result += `2. æ£€æŸ¥ä»“åº“åç§°æ˜¯å¦æ‹¼å†™æ­£ç¡®\n`;
                        result += `3. ç¡®è®¤ Obsidian å·²æ‰“å¼€è¯¥ä»“åº“\n`;
                        showResult(result, false);
                    } else {
                        result += `âš ï¸ ä»“åº“è®¿é—®å¼‚å¸¸ (${vaultResponse.status})\n`;
                        showResult(result, false);
                    }
                } else {
                    result += `âŒ API æœåŠ¡ä¸å¯ç”¨ (${response.status})\n`;
                    result += `\nğŸ’¡ è¯·æ£€æŸ¥:\n`;
                    result += `1. Obsidian æ˜¯å¦æ­£åœ¨è¿è¡Œ\n`;
                    result += `2. Local REST API æ’ä»¶æ˜¯å¦å·²å®‰è£…å¹¶å¯ç”¨\n`;
                    result += `3. ç«¯å£è®¾ç½®æ˜¯å¦æ­£ç¡®\n`;
                    showResult(result, false);
                }
                
            } catch (error) {
                const result = `âŒ è¿æ¥å¤±è´¥: ${error.message}\n\nğŸ’¡ å¸¸è§åŸå› :\n1. Obsidian æœªå¯åŠ¨\n2. Local REST API æ’ä»¶æœªå¯ç”¨\n3. ç«¯å£å·é”™è¯¯\n4. ç½‘ç»œè¿æ¥é—®é¢˜`;
                showResult(result, false);
            } finally {
                setLoading(false);
            }
        }

        // åˆ›å»ºæµ‹è¯•ç¬”è®°
        async function createTestNote() {
            const config = getConfig();
            setLoading(true);
            
            try {
                const now = new Date();
                const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, -5);
                const fileName = `æµ‹è¯•ç¬”è®°-${timestamp}.md`;
                
                const content = `# ğŸ§ª API æµ‹è¯•ç¬”è®°

**åˆ›å»ºæ—¶é—´**: ${now.toLocaleString()}
**æµ‹è¯•å·¥å…·**: Obsidian API æµ‹è¯•å·¥å…·
**API ç«¯å£**: ${config.port}
**ä»“åº“åç§°**: ${config.vault}

---

## ğŸ“ æµ‹è¯•å†…å®¹

è¿™æ˜¯ä¸€æ¡é€šè¿‡ Local REST API åˆ›å»ºçš„æµ‹è¯•ç¬”è®°ã€‚

### âœ… æµ‹è¯•é¡¹ç›®
- [x] API è¿æ¥æµ‹è¯•
- [x] æ–‡ä»¶åˆ›å»ºæµ‹è¯•
- [x] Markdown æ ¼å¼æµ‹è¯•
- [x] ä¸­æ–‡å†…å®¹æµ‹è¯•

### ğŸ·ï¸ æ ‡ç­¾
#æµ‹è¯• #API #Obsidian

---

*ç”± Obsidian API æµ‹è¯•å·¥å…·åˆ›å»ºäº ${now.toLocaleString()}*
`;

                const url = `http://localhost:${config.port}/vault/${encodeURIComponent(config.vault)}/${encodeURIComponent(fileName)}`;
                
                console.log('åˆ›å»ºæµ‹è¯•ç¬”è®°:', url);
                console.log('æ–‡ä»¶å†…å®¹:', content);
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'text/markdown',
                        'Accept': 'application/json'
                    },
                    body: content
                });
                
                let result = `ğŸ“ åˆ›å»ºæµ‹è¯•ç¬”è®°ç»“æœ:\n\n`;
                result += `æ–‡ä»¶å: ${fileName}\n`;
                result += `API åœ°å€: ${url}\n`;
                result += `å“åº”çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                
                if (response.ok) {
                    result += `âœ… æµ‹è¯•ç¬”è®°åˆ›å»ºæˆåŠŸ!\n`;
                    result += `\nğŸ“‚ è¯·æ£€æŸ¥ Obsidian ä¸­æ˜¯å¦å‡ºç°äº†æ–‡ä»¶: ${fileName}\n`;
                    result += `\nğŸ‰ æ­å–œ! API è¿æ¥å®Œå…¨æ­£å¸¸ï¼Œå¯ä»¥æ­£å¸¸ä½¿ç”¨æ‰©å±•åŠŸèƒ½ã€‚`;
                    showResult(result, true);
                } else {
                    const errorText = await response.text();
                    result += `âŒ åˆ›å»ºå¤±è´¥!\n`;
                    result += `é”™è¯¯è¯¦æƒ…: ${errorText}\n`;
                    
                    if (response.status === 404) {
                        result += `\nğŸ’¡ 404 é”™è¯¯é€šå¸¸è¡¨ç¤º:\n`;
                        result += `1. ä»“åº“åç§° "${config.vault}" ä¸å­˜åœ¨\n`;
                        result += `2. è¯·æ£€æŸ¥ Obsidian ä¸­çš„å®é™…ä»“åº“åç§°\n`;
                        result += `3. ç¡®ä¿ä»“åº“åç§°æ‹¼å†™å®Œå…¨æ­£ç¡®`;
                    }
                    
                    showResult(result, false);
                }
                
            } catch (error) {
                const result = `âŒ åˆ›å»ºæµ‹è¯•ç¬”è®°å¤±è´¥: ${error.message}\n\nğŸ’¡ è¯·å…ˆè¿è¡Œ"æµ‹è¯•è¿æ¥"ç¡®è®¤ API å¯ç”¨æ€§`;
                showResult(result, false);
            } finally {
                setLoading(false);
            }
        }

        // æµ‹è¯•æ‰€æœ‰ API ç«¯ç‚¹
        async function testApiEndpoints() {
            const config = getConfig();
            setLoading(true);
            
            try {
                const baseUrl = `http://localhost:${config.port}`;
                let result = `ğŸ› ï¸ å…¨é¢ API æµ‹è¯•ç»“æœ:\n\n`;
                
                // æµ‹è¯•ç«¯ç‚¹åˆ—è¡¨
                const endpoints = [
                    { name: 'æ ¹è·¯å¾„', url: '/' },
                    { name: 'ä»“åº“æ ¹ç›®å½•', url: `/vault/${encodeURIComponent(config.vault)}` },
                    { name: 'ä»“åº“ä¿¡æ¯', url: `/vault` }
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        const url = `${baseUrl}${endpoint.url}`;
                        const response = await fetch(url, {
                            method: 'GET',
                            headers: { 'Accept': 'application/json' }
                        });
                        
                        result += `ğŸ“ ${endpoint.name}:\n`;
                        result += `   URL: ${url}\n`;
                        result += `   çŠ¶æ€: ${response.status} ${response.statusText}\n`;
                        
                        if (response.status === 200) {
                            result += `   âœ… æ­£å¸¸\n`;
                        } else if (response.status === 404) {
                            result += `   âš ï¸ æœªæ‰¾åˆ° (å¯èƒ½æ­£å¸¸)\n`;
                        } else {
                            result += `   âŒ å¼‚å¸¸\n`;
                        }
                        result += `\n`;
                        
                    } catch (error) {
                        result += `ğŸ“ ${endpoint.name}: âŒ è¿æ¥å¤±è´¥ (${error.message})\n\n`;
                    }
                }
                
                result += `\nğŸ“‹ æµ‹è¯•æ€»ç»“:\n`;
                result += `- API ç«¯å£: ${config.port}\n`;
                result += `- ä»“åº“åç§°: ${config.vault}\n`;
                result += `- æµ‹è¯•æ—¶é—´: ${new Date().toLocaleString()}\n`;
                
                showResult(result, true);
                
            } catch (error) {
                showResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, false);
            } finally {
                setLoading(false);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            console.log('ğŸ”§ Obsidian API æµ‹è¯•å·¥å…·å·²åŠ è½½');
            console.log('å½“å‰é…ç½®:', getConfig());
        });
    </script>
</body>
</html> 