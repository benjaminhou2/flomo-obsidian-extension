# Flomo & Obsidian 快速笔记

一个简洁的浏览器扩展，可以快速捕获笔记并同时发送到 Flomo、Obsidian 或两者。

*(这里应该放置最终用户界面的截图)*

## 核心功能

- **简洁界面**：干净简单的文本区域，让您专注于记录想法，避免干扰。
- **双重目标**：通过简单的复选框选择将笔记发送到 Flomo、Obsidian 或两者。
- **简单配置**：小巧的可折叠面板来设置您的 API 凭证。
- **连接测试**：直接在扩展中验证您的 Flomo 和 Obsidian API 设置。
- **键盘快捷键**：使用 `Ctrl + Enter` 即可快速提交笔记。
- **可调整窗口**：弹出窗口可以根据您的喜好调整大小。

## 安装和设置

### 1. 安装扩展
1.  将此项目下载或克隆到您电脑的本地文件夹中。
2.  打开您的 Chrome 浏览器，访问 `chrome://extensions/`。
3.  使用右上角的开关启用"开发者模式"。
4.  点击"加载已解压的扩展程序"按钮，选择您下载的项目文件夹。

### 2. 配置 API

扩展需要 API 访问权限来发送笔记。点击弹出窗口中的设置图标（⚙️）打开配置面板。

#### 配置 Flomo：
1.  **获取您的 Webhook URL**：在 Flomo 应用或网站中，转到 `设置 > API`，复制您的唯一 webhook URL。
2.  **在扩展中输入**：将 URL 粘贴到扩展设置中的"Flomo API URL"字段。
3.  **测试**：点击"测试"按钮确保连接正常。您应该看到成功消息，并在您的 Flomo 中看到新的测试备忘录。

#### 配置 Obsidian：
1.  **安装插件**：在 Obsidian 中，转到 `设置 > 社区插件`，安装 **"Local REST API"** 插件。
2.  **启用插件**：安装后启用该插件。
3.  **获取 API Token**：在插件设置中，您会找到一个长的 API token。复制它。
4.  **在扩展中输入**：
    *   将 token 粘贴到"Obsidian API Token"字段。
    *   在"Obsidian Vault Name"字段中输入您的仓库名称，名称要与 Obsidian 中显示的完全一致。
5.  **测试**：点击"测试"按钮。成功消息表示扩展可以连接到您的仓库。

## 开发历程与故障排除

这个项目经历了重大的演进过程，在此过程中面临了几个技术挑战。以下是整个历程的总结。

### 从同步工具到快速捕获的转变

该项目最初设想为一个复杂的工具，用于将笔记从 Flomo **同步**到 Obsidian。然而，这被证明是困难且不太有用的。我们转向了一个更简单、更强大的概念：一个**快速捕获**工具，可以将笔记发送**到** Flomo 和/或 Obsidian。这明确了项目的目的，并导致了完整的用户界面重新设计。

### 用户界面/用户体验改进

新用户界面的第一个版本功能正常，但存在可用性问题。弹出窗口太窄（`width: 100vw` 在扩展上下文中是对视口单位的误解）。

-   **解决方案**：我们首先设置了固定的更宽宽度（`520px`）以提高可读性。为了进一步改善可用性，我们然后在主容器中添加了 `resize: both;` CSS 属性，使弹出窗口完全可由用户调整大小。

### Obsidian 404 错误之谜

最重大的挑战是在尝试向 Obsidian 发送笔记时出现持续的 `HTTP 404: Not Found` 错误，即使 API 服务器似乎运行正常。我们的调试过程涉及几个步骤：

1.  **端口和仓库名称检查**：我们首先怀疑端口不正确或仓库名称中有拼写错误。我们将端口标准化为插件的默认值（`27123`），并添加了 `.trim()` 来清理仓库名称输入。错误仍然存在。

2.  **深度日志记录**：我们添加了"侦探级"日志记录来检查发送到 Obsidian API 的 `fetch` 请求的确切 URL、标头和正文。这确认了我们的数据正在发送，但端点本身是错误的。

3.  **误解**：我们一直假设创建笔记的 API 端点是 `PUT /vault/{vault_name}/{filename}`。这基于不完整的文档，是 404 错误的根本原因。

4.  **突破**：用户提供了关键信息，正确的方法是 `POST /notes`。此外，仓库名称不是 URL 的一部分，而是在 JSON 负载内部预期的，作为文件名的前缀（例如，`path: "vault-name/note.md"`）。

5.  **最终错误 - 双重路径**：重构代码以使用 `POST /notes` 后，我们遇到了 `400 Bad Request` 错误。日志显示文件路径被重复了（例如，`ob-flomo/ob-flomo/note.md`）。我们错误地在两个不同的地方添加了仓库名称前缀。

-   **最终解决方案**：`obsidianWriter.js` 被修正为在 `POST` 请求的 JSON 正文中正确构建路径，最终解决了问题，允许成功创建笔记。

## 最终文件结构

在清理冗余和遗留文件后，项目现在包含以下核心组件：

-   `manifest.json`：扩展的配置文件。
-   `popup.html`：弹出窗口的用户界面结构。
-   `popup.js`：用于用户界面逻辑、配置和事件处理的主脚本。
-   `styles.css`：用户界面的所有 CSS 样式。
-   `flomoAPI.js`：用于处理与 Flomo API 通信的类。
-   `obsidianWriter.js`：用于通过 Obsidian Local REST API 处理笔记创建的类。
-   `README.md`：此文件。

## 许可证

此项目根据 MIT 许可证授权。 